<link rel="stylesheet" href="github-markdown.css">

<article class="markdown-body">
<h1 id="language-survival---ai-challenge-code-festival-2014">Language Survival</h1>
<h2 id="ストーリー">ストーリー</h2>
<p>第一次プログラミング言語宗教戦争では、CJC (Colorful Jumbo Chicken) がJavaとPHPの加護を受け法王となった。 CJCによって言語宗教戦争は終結したかのように見えた・・・が、宗教戦争の引き金となった9言語 (C++, C#, Java, JavaScript, Python, Ruby, PHP, OCaml, Haskell)に反旗を翻す言語が現れた。</p>
<p>懐かしのあの言語から、今をときめくあの言語がまさかの参戦！ CJCに代わり第二次宗教線でプログラミング言語界を制する法王になるのは誰だ？！</p>
<h2 id="ルールの疑似コード">ルールの疑似コード</h2>
<p>自然言語よりコードをご希望の方に向けて、<a href="#PseudoCode">ルールの疑似コード</a>を用意した。</p>
<h2 id="ゲームの目的">ゲームの目的</h2>
<p>各 <em>プログラミング言語</em> の <em>信者数</em> によって決まる <em>勝利点</em> を、他の <em>プレイヤー</em> より多く得る。</p>
<h2 id="ゲームの大まかな流れ">ゲームの大まかな流れ</h2>
<p>プレイヤーは4人、プログラミング言語は6種類ある。</p>
<p>このゲームはターン制であり、各ターンごとに、プレイヤーたちは好きなプログラミング言語を <em>布教</em> して信者を集める。 布教の情報は一部が隠されているため、他のプレイヤーとの駆け引きが重要となる。</p>
<p>9ターンでゲームが終了し、プレイヤーたちはそれぞれのプログラミング言語に対する信者数に応じて勝利点を得る。 各プログラミング言語の信者数が最も多いプレイヤーはその言語に対する勝利点を得るが、信者数が最も少ないプレイヤーは勝利点を失ってしまう。 したがって、目当てのプログラミング言語を積極的に布教して他プレイヤーより多くの信者を集めつつ、 他のプログラミング言語に対する信者数にも気を使って失点を防ぐことが重要である。 勝利点を最も多く獲得したプレイヤーの勝利となる。</p>
<h2 id="ゲームの開始">ゲームの開始</h2>
<p>ゲームが開始すると、まずそれぞれのプログラミング言語に <em>注目度</em> が3から6の間でランダムに設定され、プレイヤーに公開される。 注目度が高いプログラミング言語ほど、ゲーム終了時に得られる（または失う）勝利点が多くなる。</p>
<h2 id="ターンの流れ">ターンの流れ</h2>
<p>ターンには <em>平日</em> ターンと <em>休日</em> ターンが存在する。 1ターン目は平日であり、1ターンごとに平日と休日が入れ替わる。 つまり、2ターンで一週間となる。</p>
<p>ターンが始まると、プレイヤーたちは一斉に布教する言語を選ぶ。 平日では1ターンで5回（5日分）布教をするが、休日では1ターンに2回（2日分）布教する。 1回の布教では1種類の言語を布教し、自分の布教した言語に対する信者数が1増える。 ただし、休日は1回の布教につき信者数が2増える。 1ターン中の布教言語の割り振りは自由である。 例えば平日であれば、バラバラの5言語を1回ずつ布教しても良いし、同じ言語を5回布教しても良い。 なお、布教言語が他のプレイヤーと同じであっても、信者数の増加に影響はない。</p>
<p>全プレイヤーが布教言語を選んだら、各プログラミング言語に対する信者数が計算される。 そのターンが平日の場合、誰がどの言語を布教したかが全員に公開される。 そのターンが休日の場合、各プログラミング言語について、その言語がそのターンに布教された合計回数のみ公開される。</p>
<p>下の表は、平日と休日の布教の特徴をまとめたものである。</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">平日</th>
<th style="text-align: left;">休日</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">布教回数</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">1回の布教で増える信者数</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">布教情報の公開</td>
<td style="text-align: left;">全情報公開</td>
<td style="text-align: left;">各言語に対する布教の回数のみ公開</td>
</tr>
</tbody>
</table>
<p>なお、5ターン目の終了時に、各プレイヤーがそれまでに獲得した信者数が休日ぶんも含めて公開される。</p>
<h2 id="ゲームの終了">ゲームの終了</h2>
<p>9ターン目が終わると、ゲームが終了し、勝利点の計算に入る。</p>
<p>各プログラミング言語で得られる勝利点は、そのプログラミング言語に対する信者数を他のプレイヤーと比べて決められる。 そのプログラミング言語に対する信者数が全プレイヤー中で最も高い場合は、注目度と同じ点数の勝利点を得る。 逆に全プレイヤー中で最も低い場合は、注目度と同じ点数の勝利点を失う。 トップや最下位のプレイヤーが複数いる場合は、注目度をそれらのプレイヤーの人数で割った点数だけ得点あるいは失点する。</p>
<p>各プレイヤーの勝利点をすべてのプログラミング言語に対して計算したら、最も勝利点の高いプレイヤーを勝者とする。 最も勝利点の高いプレイヤーが複数いる場合は、そのゲームは引き分けである。</p>
<h2 id="aiの入出力形式">AIの入出力形式</h2>
<p>AIはゲーム開始時に実行される。 ゲームを始める準備ができたら<code>READY</code>と出力したのち、ゲームの設定を入力として受け取る。 また、ターンごとに現在の情報を入力として受け取り、そのターンでの布教言語を出力する。</p>
<p>AIの思考時間には制限がある。 制限時間を超過するとAIプログラムが強制的に停止され、それ以降の行動が「全日程で0番のプログラミング言語を布教する」として処理される。</p>
<h3 id="準備完了メッセージの出力形式">準備完了メッセージの出力形式</h3>
<p>ゲームを開始する準備ができたら、<code>READY</code>と標準出力に出力する。 ゲーム開始から5秒以内に出力がなければ、AIプログラムが強制的に停止される。</p>
<h3 id="ゲーム設定の入力形式">ゲーム設定の入力形式</h3>
<p>ゲーム開始時、つまり1ターン目の初めに、ゲームの設定が以下のフォーマットで標準入力に渡される。</p>
<pre>
T P N
A<sub>0</sub> A<sub>1</sub> A<sub>2</sub> ... A<sub>5</sub>
</pre>

<ul>
<li>T: 全ターン数。</li>
<li>P: プレイヤー数。</li>
<li>N: プログラミング言語の数。</li>
<li>A<sub>n</sub>: プログラミング言語nの注目度。</li>
</ul>
<h3 id="ターン情報の入力形式">ターン情報の入力形式</h3>
<p>各ターンの初めに、現在の情報が以下のフォーマットで標準入力に渡される。</p>
<pre>
T D
B<sub>00</sub>　B<sub>01</sub> B<sub>02</sub> B<sub>03</sub>
B<sub>10</sub>　B<sub>11</sub> B<sub>12</sub> B<sub>13</sub>
B<sub>20</sub>　B<sub>21</sub> B<sub>22</sub> B<sub>23</sub>
:
:
B<sub>50</sub>　B<sub>51</sub> B<sub>52</sub> B<sub>53</sub>
R<sub>0</sub> R<sub>1</sub> R<sub>2</sub> ... R<sub>5</sub>
P<sub>0</sub> P<sub>1</sub> P<sub>2</sub> ... P<sub>5</sub>
</pre>

<ul>
<li>T: 現在のターン数。1から始まる。</li>
<li>D: 平日の場合は&quot;W&quot;, 休日の場合は&quot;H&quot;。</li>
<li>B<sub>nm</sub>: プログラミング言語nに対するプレイヤーmの公開されている（つまり平日の情報のみでわかる）信者数。このAIプレイヤー自身はプレイヤー0である。6ターン目以降は、5ターン目以前の休日の布教ぶんも含めた信者数となる。</li>
<li>R<sub>n</sub>: プログラミング言語nに対するこのAIプレイヤーの真の（つまり休日も合わせた）信者数。</li>
<li>P<sub>n</sub>: プログラミング言語nが前日の休日に布教をされた回数。</li>
</ul>
<p>P<sub>0</sub> P<sub>1</sub> P<sub>2</sub> ... P<sub>5</sub>の行は、平日のターンでのみ含まれる。</p>
<h3 id="行動の出力形式">行動の出力形式</h3>
<p>そのターンでの布教言語は、以下のフォーマットで標準出力に出力する。</p>
<ul>
<li><strong>平日の場合</strong></li>
</ul>
<pre>
  L<sub>0</sub> L<sub>1</sub> L<sub>2</sub> L<sub>3</sub> H<sub>L</sub>
  </pre>

<ul>
<li><strong>休日の場合</strong></li>
</ul>
<pre>
  L<sub>0</sub> L<sub>1</sub>
  </pre>

<p>L<sub>n</sub>: 布教するプログラミング言語の番号（0から5で指定）。L<sub>0</sub>からL<sub>4</sub>の順番は関係しない。</p>
<p>一度行動を出力すると、そのAIのターンは終了となる。 なお、ターン開始から1秒以内に出力がなければ、AIプログラムが強制的に停止される。</p>
<p><a name="PseudoCode"></a></p>
<h2 id="ルールの疑似コード-1">ルールの疑似コード</h2>
<pre><code>programming_language = (attention, revealed_believers[4], real_believers[4])

main:
    init
    while turn &lt;= 9:
        process_turn
        turn += 1
    finish

init:
    players = player[4]
    languages = programming_language[6] (rand(3, 6), [0, 0, 0, 0], [0, 0, 0, 0])
    turn = 1

process_turn:
    for l in languages:
        display_to_all_players(l.attention)
        display_to_all_players(l.revealed_believers)
        if not is_holiday:
            display_to_all_players(l.propagated)
        l.propagated = 0

    for p in players:
        for i in [1 .. (is_holiday ? 2 : 5)]:
            target = languages[p.selected[i]]
            target.revealed_believers[p] += (is_holiday ? 0 : 1)
            target.real_believers[p] += 1
            target.propagated += 1

    if turn == 5:
        for h in heroines:
            h.revealed_believers = h.real_believers

is_holiday:
    turn % 2 == 0

finish:
    for l in languages:
        best_players = players.max_by(p -&gt; l.real_believers[p])
        for p in best_players:
            p.victory_points += h.attention / best_players.size

        worst_players = players.min_by(p -&gt; l.real_believers[p])
        for p in worst_players:
            p.victory_points -= h.attention / worst_players.size

    winners = players.max_by(p -&gt; p.victory_points)
    draw if winners.size &gt; 1</code></pre>
</article>
